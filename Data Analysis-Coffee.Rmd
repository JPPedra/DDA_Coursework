---
title: "CS5811-Data Distributed Analysis-Data Analysis on Arabica Coffee Beans"
author: "Hawra Nawrozzadeh, Joao Pedro Azevedo, and Roberta Sammarco"
date: "10/02/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

# 1. Introduction

- This RMarkdown file will contain the data analysis on the Arabica Coffee Beans. 
- This will include the data cleaning and preparation, and the exploratory data analysis (EDA), which is performed and carried together as a group.
- Then each of the member of the group, will perform different Machine learning (ML) High Performance Computational and Infrastructure (HPCI) in order to see which techniques best answered our research question: ***"Given the quality measures of the Arabica coffee beans, can we predict where these coffees are originated from?"***


# 2. Loading the Libraries

```{r}
library(dplyr)
library(tidyverse)
library(validate)
```

# 3. Data Cleaning and Preparation

## 3.1 Loading the data 

```{r}
coffee <- read.csv("data/Coffee-modified.csv")
```

## 3.2 Data Qaulity Check (or something like this)

```{r}
str(coffee)
summary(coffee)
```

- 35 categorical/character variables
- 9 continous variables
- incorrect data types
- cant get much from `summary()` function--> use `stringAsFactor = T` to get some more insight 

```{r}
coffee_fac_lev <- read.csv("data/Coffee-modified.csv", stringsAsFactors = T)
str(coffee_fac_lev)
summary(coffee_fac_lev)
```

- There is alot of errors and redudant information
- can see the amount of missings informations, etc. 
(maybe this is where we use the validate package?)
- As a results, in order to answer our research, we would only need the following variables....

----
à	ID
à	Owner
à	Farm Name
à	Lot Number
à	Mill 
à	ICO Number
à	Company
à	Region
à	Producer
à	In country Partner
à	Harvest Year
à	Owner 1
à	Expiration
à	Certification Body
à	certification address 
à	Certification number
à	Unit of measurements

----

```{r}
#----
# colnames(coffee)
# coffee %>%
#   select(-c("Owner", "Farm.Name", "Lot.Number", "Mill", "ICO.Number", "Company","Region","Producer","In.Country.Partner","Harvest.Year","Owner.1","Variety", "Expiration", "Certification.Body","Certification.Address","Certification.Contact","unit_of_measurement"))
# 
# colnames(coffee1)
# 
# # football_num <- football %>%
# #   select(-c("sofifa_id", "club_name", "preferred_foot"))
# # 
# # coffee_new <- coffee[ ,c(1, 2, 4, 10, 13, 14, 17, 19:32, 34, 42:44)]
# -----

colnames(coffee)
# coffee_new <- coffee %>%
#   select(-c("Owner", "Farm.Name", "Lot.Number", "Mill", "ICO.Number", "Company","Region","Producer","In.Country.Partner","Harvest.Year","Owner.1","Variety", "Expiration", "Certification.Body","Certification.Address","Certification.Contact","unit_of_measurement"))

colnames(coffee_new)
str(coffee_new)

## should get rid of (processing methods), color, and species as these are associated with the bean metadata and not the part of the quality of the coffee, plus they have alot of missing rows

coffee_new <- coffee %>%
  select(-c( ## removing data regarding the Farm 
            "Owner", "Farm.Name", "Lot.Number", "Mill", "ICO.Number",
            "Company","Region","Producer","In.Country.Partner","Harvest.Year","Owner.1","Variety", "Expiration",
            "Certification.Body","Certification.Address","Certification.Contact","unit_of_measurement",
            ## removing data regard the bean
            "Color", "Species", "Altitude", "altitude_low_meters", "altitude_high_meters", "altitude_mean_meters", "ID", "Grading.Date"
            )
         )
colnames(coffee_new)
str(coffee_new)
summary(coffee_new)
```


```{r}
coffee.rules <- validator(okID = ID>=0, 
                          SpeciesCorrect = is.element(Species,c("Arabica")), 
                          NoNegAltitude = Altitude>0, 
                          NoExtremeAltitude = Altitude< 200000, 
                          NonNegBags = Number.of.Bags>0, 
                          NonNegWeight = Bag.Weight>0, 
                          CorrectMethod = is.element(Processing.Method,
                                                     c("Washed / Wet", "Natural/ Dry", "Pulped natural / honey", "Semi-washed / Semi-pulped", "Other")), 
                          NoNegAroma = Aroma>0, 
                          NoNegFlavor = Flavor>0, 
                          NoNegAftertaste = Aftertaste>0, 
                          NoNegAcidity = Acidity>0, 
                          NoNegBody = Body>0, 
                          NoNegBalance = Balance>0,  
                          NoNegUniformity = Uniformity>0, 
                          NoExtUniformity = Uniformity<=10,  
                          NoNegCup = Clean.Cup>0, 
                          NoExtClean.Cup  = Clean.Cup <=10,  
                          NoNegSweetness = Sweetness>0, 
                          NoExtSweetness = Sweetness<=10, 
                          NoNegPoints = Cupper.Points>0, 
                          NoExtPoints = Cupper.Points<=10, 
                          NoNegTotalPoints = Total.Cup.Points>0, 
                          NoExtTotalPoints = Total.Cup.Points<=100, 
                          NoNegMoisture = Moisture>0, 
                          NoNegQuakers = Quakers>=0, 
                          NoExtQuakers = Quakers <=3,
                          ColorCorrect = is.element(Color,
                                                    c("Green", "None" , "Bluish-Green", "Blue-Green")),
                          NoMinaltitute = altitude_low_meters>=1,
                          NoextAltitute = altitude_low_meters <= 190164,
                          NoMinaltitute = altitude_high_meters>=1,
                          NoextAltitute = altitude_high_meters <= 190164,
                          NoMinaltitute = altitude_mean_meters>=1,
                          NoextAltitute = altitude_mean_meters <= 190164
) 

out   <- confront(coffee_new, coffee.rules)
out_1 <- confront(coffee, coffee.rules)
summary(out)
plot(out)
```

investigating further to identify the errors and see from there what is the appropriate approach
```{r}
colnames(coffee_new)
str(coffee_new)

table(coffee_new$ID)
#which(duplicated(coffee_new$ID))
table(coffee_new$Species)
table(coffee_new$Country.of.Origin)
table(coffee_new$Altitude)
table(coffee_new$Number.of.Bags)
table(coffee_new$Bag.Weight)
table(coffee_new$Grading.Date)
table(coffee_new$Processing.Method)
table(coffee_new$Aroma)
table(coffee_new$Flavor)
table(coffee_new$Aftertaste)
table(coffee_new$Acidity)
table(coffee_new$Body)
table(coffee_new$Balance)
table(coffee_new$Uniformity)
table(coffee_new$Clean.Cup)
table(coffee_new$Sweetness)
table(coffee_new$Cupper.Points)
table(coffee_new$Total.Cup.Points)
table(coffee_new$Moisture)
table(coffee_new$Category.One.Defects)
table(coffee_new$Quakers)
table(coffee_new$Color)
table(coffee_new$Category.Two.Defects)
table(coffee_new$altitude_low_meters)
table(coffee_new$altitude_high_meters)
table(coffee_new$altitude_mean_meters)
```

- Assessing Empty Rows
```{r}
summary(coffee_new)
colSums(is.na(coffee_new))



View(table(coffee_new$Country.of.Origin))
#football_df$wage_eur[football_df$wage_eur == 6.0001]
coffee_new[which(coffee_new$Country.of.Origin == ""),  ]



colSums(coffee_new == "")
empty_rows <- which(coffee_new =="", arr.ind=TRUE)
View(unique(empty_rows))
empty_rows <- as.data.frame(empty_rows)
which(duplicated(empty_rows$row))
order(unique(empty_rows$row))
View(unique(empty_rows))
empty_rows

coffee_new[which(coffee_new == ""), c("Country.of.Origin")]

b <- coffee_new[Reduce(`&`, lapply(coffee_new, function(x) !(x==""))),]
summary(b)
colSums(b == "")
colSums(is.na(b))
#coffee_new[!apply(coffee_new == "", 1, all),]
# a <- coffee_new[-which(coffee_new == ""), ]
# 
#a <- coffee_new[!apply(coffee_new == "", 1, all),]
# 
# allmisscols <- sapply(coffee_new, function(x) all(is.na(x) | x == '' ))
# 
# empty_columns <- colSums(coffee_new == "") == nrow(coffee_new)
# a<- coffee_new[ , !empty_columns] 
# 
# 
# c <- coffee_new[rowSums(coffee_new=="")!=ncol(coffee_new), ]
table(b$Country.of.Origin)
```


```{r}
subset(coffee_new, Country.of.Origin == "")

which(is.null(coffee_new))
coffee_new[which(coffee_new == ""), ]

football[which(football == " "), c(1:17)] 


# coffee_new_1 <- coffee_new[!apply(coffee_new == "", 1, all),]
# coffee_new_1
```


```{r}
boxplot(as.double(coffee_new$Aroma))
aroma_bp <- boxplot(as.double(coffee_new$Aroma))
aroma_bp$out
```

```{r}
colnames(coffee_new)
str(coffee_new)

#bp_id <- boxplot(as.integer(coffee_new$ID), plot = F)
#as.integer(coffee_new$Altitude)  # altitude as integer introduces alot of NA as there where alot data points with different unit measures

# which(is.na(as.integer(coffee_new$Number.of.Bags)))
# boxplot(as.integer(coffee_new$Number.of.Bags))
bp_NoOfBag <- boxplot(as.integer(coffee_new$Number.of.Bags), plot = F)
bp_BagWeight <- boxplot(as.integer(coffee_new$Bag.Weight), plot = F)
#which(is.na(as.numeric(coffee_new$Aroma)))
bp_Aroma <- boxplot(as.numeric(coffee_new$Aroma), plot = F)
bp_Flavor <- boxplot(as.numeric(coffee_new$Flavor), plot = F)
bp_Aftertaste <- boxplot(as.numeric(coffee_new$Aftertaste), plot = F)
bp_Acidity <- boxplot(as.numeric(coffee_new$Acidity), plot = F)
bp_Body <- boxplot(as.numeric(coffee_new$Body), plot = F)
bp_Balance <- boxplot(as.numeric(coffee_new$Balance), plot = F)
bp_Uniformity <- boxplot(as.numeric(coffee_new$Uniformity), plot = F)
bp_CleanCup <- boxplot(as.numeric(coffee_new$Clean.Cup), plot = F)
bp_Sweetness <- boxplot(as.numeric(coffee_new$Sweetness), plot = F)
bp_Aftertaste <- boxplot(as.numeric(coffee_new$Aftertaste), plot = F)
bp_CupperPoint <- boxplot(as.numeric(coffee_new$Cupper.Points), plot = F)
bp_Moisture <- boxplot(as.numeric(coffee_new$Moisture), plot = F)

coffee_filter <- 
  coffee_new$Number.of.Bags < min(bp_NoOfBag$out) &
  coffee_new$Bag.Weight < min(bp_BagWeight$out) &
  coffee_new$Aroma < min(bp_Aroma$out) &
  coffee_new$Flavor < min(bp_Flavor$out) &
  coffee_new$Aftertaste < min(bp_Aftertaste$out) &
  coffee_new$Acidity < min(bp_Acidity$out) &
  coffee_new$Body < min(bp_Body$out) &
  coffee_new$Balance < min(bp_Balance$out) &
  coffee_new$Uniformity < min(bp_Uniformity$out) &
  coffee_new$Clean.Cup < min(bp_CleanCup$out) &
  coffee_new$Sweetness < min(bp_Sweetness$out) &
  coffee_new$Aftertaste < min(bp_Aftertaste$out) &
  coffee_new$Cupper.Points < min(bp_CupperPoint$out) &
  coffee_new$Moisture < min(bp_Moisture$out)

coffee_new_clean <- coffee_new[coffee_filter, ]



# then make a filter condition to make sure that all the points for all three atrribute are less then outliers (min of the outliers)
spending_filter <- 
  customers$Fresh < min(bp_Fresh$out) & 
  customers$Milk < min(bp_Milk$out) & 
  customers$Grocery < min(bp_Groceries$out)

# Apply the condition to the new object of the same dataset
customers_clean <- customers[spending_filter,]
```


- look out for duplicates
- look out for outliers
- look out for missing data <- imputation
- visualize and show the improvements made





Extra Experiment
```{r}
# experimenting with each target variable to have
sapply(coffee, table)
sapply(head(table(coffee$ID), 20))

head(sapply(coffee, table), 20)

coffee_1<- coffee
coffee_1<- as.integer(coffee_1$Altitude)
is.na(coffee_1$Altitude)

any(is.na(coffee_1))

coffee_1[which(coffee_1 == " "), c(10)]

sum(!complete.cases(coffee$Altitude))

sum(coffee$Altitude=="")
sum(coffee$Country.of.Origin=="")
View(table(coffee$Country.of.Origin))
sum(coffee$Processing.Method=="")
View(table(coffee$Processing.Method))
```

# 4. Exploratory Data Analysis












