---
title: "CS5811-Data Distributed Analysis-Data Analysis on Arabica Coffee Beans"
author: "Hawra Nawrozzadeh, Joao Pedro Azevedo, and Roberta Sammarco"
date: "10/02/2022"
output: html_document
editor_options: 
  chunk_output_type: console
---

# 1. Introduction

- data is on Arabic coffee
- show metadata
- Research Question: ***"Given the quality measures of the Arabica coffee beans, can we predict where these coffees are originated from?"***

# 2. Loading the Libraries

```{r}
# For data cleaning and preparation
library(dplyr)
library(tidyverse)
library(validate)
# For Data visualisation

```

# 3. Data Cleaning and Preparation

## 3.1 Loading the data 

```{r}
coffee <- read.csv("data/Coffee-modified.csv")
```


## 3.2 Data Qaulity Check (or something like this)

Let's look into the structure of the data set
```{r}
str(coffee)
summary(coffee)
```

-From the `summary()` and `str()` function, it seems R has processed the dataset with  35 attributes categorical variables and the rest of the 9 attributes to be numerical continuous.
- However, this seems to be incorrect format because the in correct datatype..... e.g. ID and bla bla should be integer instead ...
- Additionally, we can already identify errors such as missing data and possible outliers (from looking at the ranges)...

- Lets further look into the different levels by creating an object that converts the strings into a factor. By doing this, we can also see other details that we will help us to decide which attributes are redundant or irrelavent for our research question.

- The `summary()` and `str()` function shows that the dataset contains

- 35 categorical/character variables
- 9 continuous variables
- incorrect data types
- cant get much from `summary()` function--> use `stringAsFactor = T` to get some more insight 

```{r}
coffee_fac_lev <- read.csv("data/Coffee-modified.csv", stringsAsFactors = T)
str(coffee_fac_lev)
summary(coffee_fac_lev)
```

validate 
```{r}
coffee.rules <- validator(okID = ID>=0, 
                          SpeciesCorrect = is.element(Species,c("Arabica")), 
                          NoNegAltitude = Altitude>0, 
                          NoExtremeAltitude = Altitude< 200000, 
                          NonNegBags = Number.of.Bags>0, 
                          NonNegWeight = Bag.Weight>0, 
                          CorrectMethod = is.element(Processing.Method,
                                                     c("Washed / Wet", "Natural/ Dry", "Pulped natural / honey", "Semi-washed / Semi-pulped", "Other")), 
                          NoNegAroma = Aroma>0, 
                          NoNegFlavor = Flavor>0, 
                          NoNegAftertaste = Aftertaste>0, 
                          NoNegAcidity = Acidity>0, 
                          NoNegBody = Body>0, 
                          NoNegBalance = Balance>0,  
                          NoNegUniformity = Uniformity>0, 
                          NoExtUniformity = Uniformity<=10,  
                          NoNegCup = Clean.Cup>0, 
                          NoExtClean.Cup  = Clean.Cup <=10,  
                          NoNegSweetness = Sweetness>0, 
                          NoExtSweetness = Sweetness<=10, 
                          NoNegPoints = Cupper.Points>0, 
                          NoExtPoints = Cupper.Points<=10, 
                          NoNegTotalPoints = Total.Cup.Points>0, 
                          NoExtTotalPoints = Total.Cup.Points<=100, 
                          NoNegMoisture = Moisture>0, 
                          NoNegQuakers = Quakers>=0, 
                          NoExtQuakers = Quakers <=3,
                          ColorCorrect = is.element(Color,
                                                    c("Green", "None" , "Bluish-Green", "Blue-Green")),
                          NoMinaltitute = altitude_low_meters>=1,
                          NoextAltitute = altitude_low_meters <= 190164,
                          NoMinaltitute = altitude_high_meters>=1,
                          NoextAltitute = altitude_high_meters <= 190164,
                          NoMinaltitute = altitude_mean_meters>=1,
                          NoextAltitute = altitude_mean_meters <= 190164
) 

out   <- confront(coffee_new, coffee.rules)
out_1 <- confront(coffee, coffee.rules)
summary(out)
plot(out)
```

- There is alot of errors and redudant information
- can see the amount of missings informations, etc. 
(maybe this is where we use the validate package?)
- As a results, in order to answer our research, we would only need the following variables....

----
à	ID
à	Owner
à	Farm Name
à	Lot Number
à	Mill 
à	ICO Number
à	Company
à	Region
à	Producer
à	In country Partner
à	Harvest Year
à	Owner 1
à	Expiration
à	Certification Body
à	certification address 
à	Certification number
à	Unit of measurements
^^ this is needs to be fixed accordingly

----

```{r}
#----
# colnames(coffee)
# coffee %>%
#   select(-c("Owner", "Farm.Name", "Lot.Number", "Mill", "ICO.Number", "Company","Region","Producer","In.Country.Partner","Harvest.Year","Owner.1","Variety", "Expiration", "Certification.Body","Certification.Address","Certification.Contact","unit_of_measurement"))
# 
# colnames(coffee1)
# 
# # football_num <- football %>%
# #   select(-c("sofifa_id", "club_name", "preferred_foot"))
# # 
# # coffee_new <- coffee[ ,c(1, 2, 4, 10, 13, 14, 17, 19:32, 34, 42:44)]
# -----

colnames(coffee)
# coffee_new <- coffee %>%
#   select(-c("Owner", "Farm.Name", "Lot.Number", "Mill", "ICO.Number", "Company","Region","Producer","In.Country.Partner","Harvest.Year","Owner.1","Variety", "Expiration", "Certification.Body","Certification.Address","Certification.Contact","unit_of_measurement"))

colnames(coffee_new)
str(coffee_new)

## should get rid of (processing methods), color, and species as these are associated with the bean metadata and not the part of the quality of the coffee, plus they have alot of missing rows

coffee_new <- coffee %>%
  select(-c( ## removing data regarding the Farm 
            "Owner", "Farm.Name", "Lot.Number", "Mill", "ICO.Number",
            "Company","Region","Producer","In.Country.Partner","Harvest.Year","Owner.1","Variety", "Expiration",
            "Certification.Body","Certification.Address","Certification.Contact","unit_of_measurement",
            ## removing data regard the bean
            "Color", "Species", "Altitude", "altitude_low_meters", "altitude_high_meters", "altitude_mean_meters", "ID", "Grading.Date"
            )
         )
colnames(coffee_new)
str(coffee_new)
summary(coffee_new)
```

- Assessing Empty Rows
```{r}
summary(coffee_new)
colSums(is.na(coffee_new))
colSums(coffee_new == "")

coffee_new_1 <- coffee_new[Reduce(`&`, lapply(coffee_new, 
                                              function(x) !(x==""))),]

colSums(is.na(coffee_new_1))
colSums(coffee_new_1 == "")
```

Investigating further to identify the errors and see from there what is the appropriate approach
```{r}
table(coffee_new_1$Country.of.Origin)
table(coffee_new_1$Number.of.Bags)
table(coffee_new_1$Bag.Weight) ##
table(coffee_new_1$Processing.Method)
table(coffee_new_1$Aroma) ##
table(coffee_new_1$Flavor) 
table(coffee_new_1$Aftertaste) 
table(coffee_new_1$Acidity) 
table(coffee_new_1$Body)
table(coffee_new_1$Balance)
table(coffee_new_1$Uniformity) ##
table(coffee_new_1$Clean.Cup) ##
table(coffee_new_1$Sweetness) ##
table(coffee_new_1$Cupper.Points) ##
table(coffee_new_1$Total.Cup.Points) ##
table(coffee_new_1$Moisture) 
table(coffee_new_1$Category.One.Defects)
table(coffee_new_1$Quakers) ##
table(coffee_new_1$Category.Two.Defects)
```

-dealing with Bag Weight first
  - all string 
  - Majority is kg put there are some in ilbs
  - Created a function to fix this so that all the values are converted to numeric and all have the same unit
```{r}
exp <- coffee_new_1
table(exp$Bag.Weight)

exp$Bag.Weight <- exp$Bag.Weight %>% 
  replace_na("9900 kg")

colSums(is.na(exp))

conversion <- function(x){
  # splitting the string; y is a list
  y <- strsplit(x, " ")
  
  if (y[[1]][2] == "lbs") { #traversing the list within a list
    x <- gsub(" lbs", "", x)
    x <- 0.45 * as.numeric(x)
  } else {
    x <- gsub(" kg", "", x)
    x <- as.numeric(x)
  }
}

exp$Bag.Weight <- sapply(exp$Bag.Weight, FUN = conversion)
table(coffee_new_1$Bag.Weight)
table(exp$Bag.Weight)
exp$Bag.Weight
```


- look out for duplicates??
- look out for outliers
- look out for missing data <- imputation
- visualize and show the improvements made

- Maybe here we can show the visual representation of before and after cleaning the data

# 4. Exploratory Data Analysis












